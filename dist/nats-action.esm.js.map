{"version":3,"file":"nats-action.esm.js","sources":["../src/index.ts"],"sourcesContent":["import { info, setFailed, getInput } from '@actions/core';\nimport { exec } from 'child_process';\n\nconst parsePorts = () => {\n  return getInput('port')\n    .split(' ')\n    .map(v => parseInt(v))\n    .filter(v => !isNaN(v) && v >= 0);\n};\n\nconst startServer = (\n  port: number,\n  clusterPort?: number,\n  routePort?: number,\n  masterName?: string\n) => {\n  let options: string[] = [];\n  options.push(...['-d', '-p', `${port}:${port}`]);\n  if (clusterPort)\n    options.push(...['--cluster', `nats://0.0.0.0:${clusterPort}`]);\n  if (routePort && masterName)\n    options.push(...['--routes', `nats://${masterName}:${routePort}`]);\n  options.push('nats');\n  options = ['sudo', 'docker', 'run'].concat(options);\n  exec(options.join(' '), e => {\n    if (e) setFailed(`failed to start server due to ${JSON.stringify(e)}`);\n  });\n};\n\nconst ports = parsePorts();\n\nif (!ports.length) setFailed(`require at least 1 port`);\n\ninfo(`ports ${ports.join(', ')} will be used`);\n\nif (ports.length === 1) {\n  startServer(ports[0]);\n} else {\n}\n"],"names":["parsePorts","getInput","split","map","v","parseInt","filter","isNaN","startServer","port","clusterPort","routePort","masterName","options","push","concat","exec","join","e","setFailed","JSON","stringify","ports","length","info"],"mappings":";;;AAGA,IAAMA,UAAU,GAAG,SAAbA,UAAa;AACjB,SAAOC,QAAQ,CAAC,MAAD,CAAR,CACJC,KADI,CACE,GADF,EAEJC,GAFI,CAEA,UAAAC,CAAC;AAAA,WAAIC,QAAQ,CAACD,CAAD,CAAZ;AAAA,GAFD,EAGJE,MAHI,CAGG,UAAAF,CAAC;AAAA,WAAI,CAACG,KAAK,CAACH,CAAD,CAAN,IAAaA,CAAC,IAAI,CAAtB;AAAA,GAHJ,CAAP;AAID,CALD;;AAOA,IAAMI,WAAW,GAAG,SAAdA,WAAc,CAClBC,IADkB,EAElBC,WAFkB,EAGlBC,SAHkB,EAIlBC,UAJkB;;;AAMlB,MAAIC,OAAO,GAAa,EAAxB;;AACA,cAAAA,OAAO,EAACC,IAAR,iBAAgB,CAAC,IAAD,EAAO,IAAP,EAAgBL,IAAhB,SAAwBA,IAAxB,CAAhB;;AACA,MAAIC,WAAJ,EACE,aAAAG,OAAO,EAACC,IAAR,kBAAgB,CAAC,WAAD,sBAAgCJ,WAAhC,CAAhB;AACF,MAAIC,SAAS,IAAIC,UAAjB,EACE,aAAAC,OAAO,EAACC,IAAR,kBAAgB,CAAC,UAAD,cAAuBF,UAAvB,SAAqCD,SAArC,CAAhB;AACFE,EAAAA,OAAO,CAACC,IAAR,CAAa,MAAb;AACAD,EAAAA,OAAO,GAAG,CAAC,MAAD,EAAS,QAAT,EAAmB,KAAnB,EAA0BE,MAA1B,CAAiCF,OAAjC,CAAV;AACAG,EAAAA,IAAI,CAACH,OAAO,CAACI,IAAR,CAAa,GAAb,CAAD,EAAoB,UAAAC,CAAC;AACvB,QAAIA,CAAJ,EAAOC,SAAS,oCAAkCC,IAAI,CAACC,SAAL,CAAeH,CAAf,CAAlC,CAAT;AACR,GAFG,CAAJ;AAGD,CAjBD;;AAmBA,IAAMI,KAAK,gBAAGtB,UAAU,EAAxB;AAEA,IAAI,CAACsB,KAAK,CAACC,MAAX,EAAmBJ,SAAS,2BAAT;AAEnBK,IAAI,YAAUF,KAAK,CAACL,IAAN,CAAW,IAAX,CAAV,mBAAJ;;AAEA,IAAIK,KAAK,CAACC,MAAN,KAAiB,CAArB,EAAwB;AACtBf,EAAAA,WAAW,CAACc,KAAK,CAAC,CAAD,CAAN,CAAX;AACD"}